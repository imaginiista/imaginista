<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRISMISSFIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fslightbox/3.4.1/index.min.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'cris-primary': '#db2777', 'cris-secondary': '#9333ea' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; scroll-behavior: smooth; }
        .text-gradient { background: linear-gradient(to right, #db2777, #9333ea); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .bg-gradient-brand { background: linear-gradient(to right, #db2777, #9333ea); }
        .hero-banner { background-image: linear-gradient(rgba(147, 51, 234, 0.4), rgba(219, 39, 119, 0.6)), url('https://images.unsplash.com/photo-1518611012118-696072aa579a?auto=format&fit=crop&w=1600&q=80'); background-size: cover; background-position: center; background-attachment: fixed; }
        
        /* CARD PRODUTO */
        /* Padroniza o tamanho da caixa da imagem para evitar quebras */
        .img-container { height: 400px; overflow: hidden; position: relative; border-radius: 12px; cursor: pointer; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .product-card:hover .img-container img { transform: scale(1.05); }
        
        /* BADGES */
        .badge { position: absolute; top: 10px; left: 10px; padding: 4px 10px; border-radius: 4px; font-size: 10px; font-weight: 900; text-transform: uppercase; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .badge-lancamento { background: black; color: white; }
        .badge-oferta { background: #db2777; color: white; }
        .badge-maisvendido { background: #9333ea; color: white; }

        /* PRE√áOS */
        .old-price { text-decoration: line-through; color: #9ca3af; font-size: 0.8rem; margin-right: 5px; font-weight: 400; }

        /* SIDEBAR & MODAIS */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 90%; max-width: 500px; max-height: 85vh; overflow-y: auto; padding: 30px; border-radius: 15px; position: relative; animation: slideUp 0.3s ease; }
        
        /* MODAL DE PRODUTO */
        .product-detail-content { width: 95%; max-width: 900px; padding: 0; display: flex; flex-direction: column; overflow: hidden; }
        @media (min-width: 768px) { .product-detail-content { flex-direction: row; height: auto; max-height: 90vh; } }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        #cart-sidebar { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .cart-open { transform: translateX(0); }
        .cart-closed { transform: translateX(100%); }
        .cat-btn.active { background-image: linear-gradient(to right, #db2777, #9333ea); color: white; border-color: transparent; }

        /* === CORRE√á√ÉO CR√çTICA DO LIGHTBOX (Bot√£o X e Imagens) === */
        
        /* 1. Esconder o bot√£o quadrado de Fullscreen (Tela Cheia) */
        .fslightbox-toolbar-button[title="Enter fullscreen"] { display: none !important; }
        .fslightbox-toolbar-button:nth-child(2) { display: none !important; } 

        /* 2. Estilizar o bot√£o de Fechar (X) para ficar vis√≠vel e bonito */
        .fslightbox-toolbar-button:first-child {
            background: #db2777 !important; /* Cor Rosa da marca */
            width: 45px !important;
            height: 45px !important;
            border-radius: 50% !important; /* Bolinha */
            top: 20px !important;
            right: 20px !important;
            opacity: 1 !important;
            border: 2px solid white !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important;
        }
        /* Efeito ao passar o mouse no X */
        .fslightbox-toolbar-button:first-child:hover {
            transform: scale(1.1) !important;
            background: #be185d !important;
        }
        /* Garante que o √≠cone SVG dentro do bot√£o seja branco */
        .fslightbox-toolbar-button svg path { fill: white !important; }

    </style>
</head>
<body class="text-gray-800 antialiased overflow-x-hidden">

    <header class="bg-white/95 backdrop-blur-md p-4 sticky top-0 z-50 border-b border-pink-100 shadow-sm">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-black tracking-tighter italic text-gradient cursor-pointer" onclick="window.scrollTo(0,0)">
                CRIS<span class="font-light">MISS</span>FIT
            </h1>
            <div class="hidden md:flex flex-grow max-w-md mx-12">
                <div class="relative w-full group">
                    <input type="text" id="search-input" onkeyup="filterProducts()" placeholder="Buscar pe√ßas..." class="w-full bg-pink-50 border border-pink-100 rounded-full py-2 px-10 text-sm focus:border-pink-400 outline-none transition group-hover:bg-white">
                    <i class="fas fa-search absolute left-4 top-2.5 text-pink-300"></i>
                </div>
            </div>
            <button onclick="toggleCart(true)" class="relative p-2 group">
                <i class="fas fa-shopping-bag text-2xl text-gray-800 group-hover:text-pink-600 transition"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-gradient-brand text-white text-[10px] h-5 w-5 rounded-full flex items-center justify-center font-bold">0</span>
            </button>
        </div>
    </header>

    <section class="relative h-[60vh] flex items-center justify-center hero-banner text-white">
        <div class="z-10 text-center px-4" data-aos="zoom-in">
            <h2 class="text-5xl md:text-8xl font-black mb-2 uppercase tracking-tighter drop-shadow-lg">CRISMISS <span class="italic text-pink-300">FIT</span></h2>
            <p class="text-lg mb-8 max-w-lg mx-auto font-light tracking-wide">Sua energia, sua moda, seu treino.</p>
            <a href="#produtos" class="bg-white text-pink-600 px-10 py-3 font-black hover:bg-pink-50 transition rounded-full uppercase tracking-wider text-sm shadow-xl">VITRINE</a>
        </div>
    </section>

    <main id="produtos" class="container mx-auto py-16 px-4">
        <div class="flex flex-col xl:flex-row items-center justify-between mb-12 gap-8" data-aos="fade-right">
            <div>
                <h3 class="text-3xl font-black uppercase italic tracking-tighter">Cat√°logo</h3>
                <p id="product-status" class="text-xs text-gray-400 font-bold tracking-[0.2em] uppercase mt-1">Carregando...</p>
            </div>
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="filterCategory('all')" class="cat-btn active border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Todos</button>
                <button onclick="filterCategory('leggings')" class="cat-btn border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Leggings</button>
                <button onclick="filterCategory('tops')" class="cat-btn border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Tops</button>
                <button onclick="filterCategory('shorts')" class="cat-btn border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Shorts</button>
                <button onclick="filterCategory('conjuntos')" class="cat-btn border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Conjuntos</button>
                <button onclick="filterCategory('acessorios')" class="cat-btn border border-gray-200 px-4 py-2 rounded-full text-[10px] font-bold uppercase hover:shadow">Acess√≥rios</button>
            </div>
        </div>

        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <div class="col-span-full py-20 text-center text-pink-300"><i class="fas fa-spinner fa-spin text-4xl"></i></div>
        </div>
    </main>

    <section class="bg-pink-50 py-20 px-4 border-t border-pink-100">
        <div class="container mx-auto">
            <h3 class="text-3xl font-black text-center mb-12 uppercase italic text-gray-800" data-aos="fade-up">O que elas <span class="text-pink-600">Dizem</span></h3>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="0">
                    <div class="flex text-pink-500 mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-gray-600 italic mb-6 text-sm">"A legging n√£o fica transparente nem no agachamento! Simplesmente a melhor qualidade que j√° comprei online."</p>
                    <div class="flex items-center gap-4">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-10 h-10 rounded-full">
                        <div><h5 class="font-bold text-sm">Amanda S.</h5><p class="text-[10px] text-gray-400 uppercase">Rio de Janeiro</p></div>
                    </div>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="100">
                    <div class="flex text-pink-500 mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-gray-600 italic mb-6 text-sm">"O conjunto chegou em 2 dias. O tecido √© super geladinho e modela muito a cintura. Comprarei mais!"</p>
                    <div class="flex items-center gap-4">
                        <img src="https://randomuser.me/api/portraits/women/65.jpg" class="w-10 h-10 rounded-full">
                        <div><h5 class="font-bold text-sm">Fernanda Lima</h5><p class="text-[10px] text-gray-400 uppercase">S√£o Paulo</p></div>
                    </div>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition" data-aos="fade-up" data-aos-delay="200">
                    <div class="flex text-pink-500 mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div>
                    <p class="text-gray-600 italic mb-6 text-sm">"Atendimento impec√°vel pelo WhatsApp e as pe√ßas s√£o lindas. O top sustenta super bem para correr."</p>
                    <div class="flex items-center gap-4">
                        <img src="https://randomuser.me/api/portraits/women/90.jpg" class="w-10 h-10 rounded-full">
                        <div><h5 class="font-bold text-sm">J√∫lia Costa</h5><p class="text-[10px] text-gray-400 uppercase">Minas Gerais</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-gray-400 py-16 px-4 text-sm">
        <div class="container mx-auto grid md:grid-cols-4 gap-8">
            <div class="col-span-2">
                <h4 class="text-white font-black mb-4 text-xl italic">CRIS<span class="text-pink-500">MISS</span>FIT</h4>
                <p class="text-xs max-w-xs mb-4">Moda fitness com tecnologia e estilo. Feito para mulheres que buscam sua melhor vers√£o.</p>
                <div class="flex gap-4">
                    <a href="#" class="hover:text-white transition"><i class="fab fa-instagram text-xl"></i></a>
                    <a href="#" class="hover:text-white transition"><i class="fab fa-facebook text-xl"></i></a>
                    <a href="#" class="hover:text-white transition"><i class="fab fa-whatsapp text-xl"></i></a>
                </div>
            </div>
            <div>
                <h5 class="text-white font-bold uppercase tracking-wider mb-4 text-xs">Institucional</h5>
                <ul class="space-y-2 text-xs">
                    <li><button onclick="openModal('sobre')" class="hover:text-pink-500 transition">Sobre a Marca</button></li>
                    <li><button onclick="openModal('termos')" class="hover:text-pink-500 transition">Termos de Uso</button></li>
                    <li><button onclick="openModal('privacidade')" class="hover:text-pink-500 transition">Pol√≠tica de Privacidade</button></li>
                </ul>
            </div>
            <div>
                <h5 class="text-white font-bold uppercase tracking-wider mb-4 text-xs">Ajuda</h5>
                <ul class="space-y-2 text-xs">
                    <li><button onclick="openModal('trocas')" class="hover:text-pink-500 transition">Trocas e Devolu√ß√µes</button></li>
                    <li><button onclick="openModal('medidas')" class="hover:text-pink-500 transition">Guia de Medidas</button></li>
                    <li><a href="https://wa.me/5521983340089" target="_blank" class="hover:text-pink-500 transition">Fale Conosco</a></li>
                </ul>
            </div>
        </div>
        <div class="text-center mt-12 pt-8 border-t border-gray-800 text-[10px]">
            <p>Desenvolvido por <strong>IMAGINISTA</strong> ¬© 2026</p>
        </div>
    </footer>

    <div id="cart-sidebar" class="fixed top-0 right-0 w-full md:w-[450px] h-full bg-white shadow-2xl z-[150] cart-closed flex flex-col">
        <div class="p-6 bg-white border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h2 class="text-xl font-black uppercase italic tracking-wider text-gray-800">Sua Sacola</h2>
            <div class="flex items-center gap-4">
                <button onclick="clearCart()" class="text-[10px] text-red-500 font-bold uppercase hover:bg-red-50 px-2 py-1 rounded transition" title="Limpar Sacola">
                    <i class="fas fa-trash-alt"></i> Limpar
                </button>
                <button onclick="toggleCart(false)" class="text-gray-400 hover:text-pink-600 text-2xl">&times;</button>
            </div>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4 bg-white"></div>
        <div class="p-6 bg-white border-t border-gray-100 shadow-[0_-10px_40px_rgba(0,0,0,0.03)] z-20 space-y-3">
            <p class="text-[10px] font-bold text-gray-400 uppercase">Entrega</p>
            <input type="text" id="cust-name" placeholder="Seu Nome" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-xs focus:border-pink-500 outline-none">
            <div class="flex gap-2">
                <input type="text" id="cust-phone" onkeyup="maskPhone(this)" placeholder="WhatsApp" class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-xs focus:border-pink-500 outline-none">
                <input type="text" id="cep-input" onkeyup="maskCEP(this)" placeholder="CEP" class="w-24 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-xs focus:border-pink-500 outline-none">
                <button onclick="searchCEP()" id="btn-cep" class="bg-gray-800 text-white px-3 rounded-lg"><i class="fas fa-search"></i></button>
            </div>
            <input type="text" id="cust-address" readonly placeholder="Endere√ßo" class="w-full bg-gray-100 border border-gray-200 rounded-lg px-4 py-3 text-xs text-gray-500">
            <div class="flex gap-2">
                <input type="number" id="cust-number" placeholder="N¬∫" class="w-20 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-xs focus:border-pink-500 outline-none">
                <input type="text" id="cust-comp" placeholder="Complemento" class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-xs focus:border-pink-500 outline-none">
            </div>
            <div class="flex justify-between items-end pt-2">
                <span id="shipping-result" class="text-xs font-bold text-pink-600"></span>
                <div>
                    <span class="text-xs text-gray-500 font-bold uppercase block text-right">Total</span>
                    <span id="cart-total" class="text-2xl font-black text-gray-800 tracking-tighter">R$ 0,00</span>
                </div>
            </div>
            <button onclick="finishOrder()" class="w-full bg-gradient-brand text-white py-4 rounded-lg font-bold hover:shadow-lg transition flex items-center justify-center gap-2 uppercase text-xs tracking-widest">
                <i class="fab fa-whatsapp text-lg"></i> Finalizar Pedido
            </button>
        </div>
    </div>

    <div id="modal-legal" class="modal-overlay" onclick="if(event.target === this) this.style.display='none'">
        <div class="modal-content">
            <button onclick="document.getElementById('modal-legal').style.display='none'" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-xl">&times;</button>
            <h2 id="modal-title" class="text-2xl font-black mb-4 uppercase italic text-gray-800"></h2>
            <div id="modal-body" class="text-sm text-gray-600 leading-relaxed space-y-4 text-justify h-full overflow-y-auto"></div>
        </div>
    </div>

    <div id="product-modal" class="modal-overlay" onclick="if(event.target === this) closeProductModal()">
        <div class="modal-content product-detail-content">
            <button onclick="closeProductModal()" class="absolute top-4 right-4 z-50 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg hover:text-red-500 transition">&times;</button>
            
            <div class="w-full md:w-1/2 bg-gray-100 h-[300px] md:h-auto relative group">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <div id="modal-badge-container" class="absolute top-4 left-4"></div>
            </div>

            <div class="w-full md:w-1/2 p-6 flex flex-col overflow-y-auto">
                <div class="mb-4 border-b border-gray-100 pb-4">
                    <span id="modal-cat" class="text-[10px] font-bold text-pink-500 uppercase tracking-widest"></span>
                    <h2 id="modal-prod-title" class="text-2xl font-black uppercase italic leading-tight mb-2"></h2>
                    <div class="flex items-end gap-3">
                        <span id="modal-price" class="text-3xl font-black text-gray-900"></span>
                        <span id="modal-old-price" class="text-lg text-gray-400 line-through font-medium mb-1"></span>
                    </div>
                    <p id="modal-desc" class="text-gray-500 text-xs mt-3 font-light leading-relaxed"></p>
                </div>

                <div class="mb-4">
                    <p class="text-[10px] font-bold uppercase mb-2">Tamanho:</p>
                    <div id="modal-sizes" class="flex gap-2 flex-wrap"></div>
                    <p id="stock-msg" class="text-[10px] mt-1 h-4 font-bold"></p>
                </div>

                <button id="modal-add-btn" class="w-full bg-black text-white py-3 rounded-lg font-bold uppercase tracking-widest hover:bg-gradient-brand transition disabled:opacity-50 disabled:cursor-not-allowed">
                    Selecione Tamanho
                </button>

                <div id="related-section" class="mt-6 pt-6 border-t border-gray-100 hidden">
                    <h4 class="text-[10px] font-black uppercase mb-3 text-gray-400">Combine com (Match)</h4>
                    <div id="related-grid" class="grid grid-cols-3 gap-3"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ once: true, offset: 50, duration: 800 });
        const mpPaymentLink = 'https://link.mercadopago.com.br/imaginista';
        let allProducts = [], cart = [], shippingValue = 0, currentCategory = 'all';
        let currentProduct = null;

        const legalTexts = {
            'sobre': '<p>A <strong>CRISMISSFIT</strong> nasceu em 2026 com o prop√≥sito de unir tecnologia t√™xtil e design para mulheres que n√£o abrem m√£o de estilo durante o treino. Nossas pe√ßas s√£o desenvolvidas no Rio de Janeiro e testadas por atletas reais.</p>',
            'termos': '<p><strong>1. ACEITA√á√ÉO:</strong> Ao acessar este site, voc√™ concorda com nossos termos.<br><strong>2. PRODUTOS:</strong> As imagens s√£o ilustrativas. Podem ocorrer pequenas varia√ß√µes de cor.<br><strong>3. PRE√áOS:</strong> Reservamo-nos o direito de alterar pre√ßos sem aviso pr√©vio.</p>',
            'privacidade': '<p><strong>LGPD:</strong> Seus dados (nome, endere√ßo, telefone) s√£o utilizados exclusivamente para processamento e entrega do pedido. N√£o compartilhamos informa√ß√µes com terceiros para fins de marketing sem consentimento. Utilizamos SSL para navega√ß√£o segura.</p>',
            'trocas': '<p><strong>DIREITO DE ARREPENDIMENTO:</strong> Conforme o CDC, voc√™ tem at√© 7 dias corridos ap√≥s o recebimento para solicitar a devolu√ß√£o por arrependimento.<br><strong>TROCA POR DEFEITO:</strong> Garantia de 30 dias para defeitos de fabrica√ß√£o. O produto deve estar com etiqueta e sem uso.</p>',
            'medidas': `` // Mantido vazio pois √© preenchido dinamicamente no openModal
        };

        function openModal(t) {
            const map = {'sobre':'Sobre N√≥s','termos':'Termos','privacidade':'Privacidade','trocas':'Trocas','medidas':'Medidas'};
            document.getElementById('modal-title').innerText = map[t];
            
            if(t === 'medidas') {
                 document.getElementById('modal-body').innerHTML = `
                 <div class="bg-pink-50 p-4 rounded-lg mb-4 text-center">
                    <h3 class="font-bold text-pink-600 mb-2">PROVADOR VIRTUAL</h3>
                    <div class="flex gap-2 mb-3">
                        <input type="number" id="sim-height" placeholder="Altura (cm)" class="w-1/2 p-2 border rounded text-xs">
                        <input type="number" id="sim-weight" placeholder="Peso (kg)" class="w-1/2 p-2 border rounded text-xs">
                    </div>
                    <button onclick="calcSize()" class="w-full bg-black text-white py-2 rounded text-xs font-bold uppercase">Calcular</button>
                    <div id="sim-result" class="mt-3 font-black text-lg text-gray-800 hidden"></div>
                </div>
                 <table class="w-full text-xs text-center border-collapse"><tr class="bg-gray-100 font-bold"><td class="p-2">TAM</td><td class="p-2">MANEQUIM</td></tr><tr class="border-b"><td class="p-2 font-bold">P</td><td class="p-2">36-38</td></tr><tr class="border-b"><td class="p-2 font-bold">M</td><td class="p-2">40-42</td></tr><tr class="border-b"><td class="p-2 font-bold">G</td><td class="p-2">44-46</td></tr><tr><td class="p-2 font-bold">GG</td><td class="p-2">48</td></tr></table>`;
            } else {
                document.getElementById('modal-body').innerHTML = legalTexts[t] || "Texto indispon√≠vel.";
            }
            document.getElementById('modal-legal').style.display = 'flex';
        }

        function calcSize() {
            const h = parseInt(document.getElementById('sim-height').value);
            const w = parseInt(document.getElementById('sim-weight').value);
            const res = document.getElementById('sim-result');
            if(!h || !w) { res.innerHTML = "Preencha!"; res.classList.remove('hidden'); return; }
            let s = w >= 78 ? 'GG' : w >= 68 ? 'G' : w >= 58 ? 'M' : 'P';
            res.innerHTML = `Sua sugest√£o: <span class="text-pink-600 text-2xl">${s}</span>`;
            res.classList.remove('hidden');
        }

        window.onload = async () => { try {
            const r = await fetch('produtos.json');
            allProducts = await r.json();
            renderProducts(allProducts);
        } catch(e){ console.log(e); document.getElementById('product-grid').innerHTML = '<p class="text-center col-span-full">Erro no Cat√°logo.</p>'; }};

        function renderProducts(data) {
            const grid = document.getElementById('product-grid');
            document.getElementById('product-status').innerText = `${data.length} ITENS`;
            if(data.length===0){ grid.innerHTML='<div class="col-span-full text-center py-10 opacity-50">Nada encontrado.</div>'; return; }
            
            grid.innerHTML = data.map((p, i) => {
                let badgeHTML = '';
                if(p.badge) {
                    const cls = p.badge.toLowerCase() === 'oferta' ? 'badge-oferta' : p.badge.toLowerCase() === 'mais vendido' ? 'badge-maisvendido' : 'badge-lancamento';
                    badgeHTML = `<div class="badge ${cls}">${p.badge}</div>`;
                }
                const priceDisplay = p.oldPrice ? `<span class="old-price">R$ ${p.oldPrice.toFixed(0)}</span> R$ ${p.price.toFixed(0)}` : `R$ ${p.price.toFixed(0)}`;

                return `<div class="product-card group" data-aos="fade-up" data-aos-delay="${i*50}">
                    <div class="bg-white rounded-xl shadow-sm hover:shadow-xl transition duration-500 overflow-hidden border border-gray-100 relative">
                        ${badgeHTML}
                        <div class="img-container bg-gray-100 relative">
                            <a data-fslightbox="gallery-${p.id}" href="${p.images[0]}">
                                <img src="${p.images[0]}" alt="${p.name}">
                            </a>
                            <div class="hidden">
                                ${p.images.slice(1).map(url => `<a data-fslightbox="gallery-${p.id}" href="${url}"></a>`).join('')}
                            </div>
                        </div>
                        
                        <div class="p-4 cursor-pointer" onclick="openProductModal(${p.id})">
                            <p class="text-[9px] text-pink-500 font-bold uppercase mb-1">${p.category}</p>
                            <h4 class="font-bold text-sm uppercase leading-tight mb-2 h-8 overflow-hidden">${p.name}</h4>
                            <div class="font-black text-lg text-gray-900">${priceDisplay}</div>
                            <button class="w-full mt-3 bg-black text-white py-2 rounded text-[10px] font-bold uppercase hover:bg-gradient-brand transition">Ver Detalhes</button>
                        </div>
                    </div>
                </div>`
            }).join('');
            refreshFsLightbox();
        }

        function openProductModal(id) {
            currentProduct = allProducts.find(p => p.id === id);
            if(!currentProduct) return;

            document.getElementById('modal-cat').innerText = currentProduct.category;
            document.getElementById('modal-prod-title').innerText = currentProduct.name;
            document.getElementById('modal-desc').innerText = currentProduct.desc || "Pe√ßa exclusiva CRISMISSFIT.";
            document.getElementById('modal-price').innerText = `R$ ${currentProduct.price.toFixed(0)}`;
            
            const oldP = document.getElementById('modal-old-price');
            if(currentProduct.oldPrice) { oldP.innerText = `R$ ${currentProduct.oldPrice.toFixed(0)}`; oldP.style.display='inline'; } 
            else { oldP.style.display='none'; }

            document.getElementById('modal-img').src = currentProduct.images[0];

            const sizesDiv = document.getElementById('modal-sizes');
            const btn = document.getElementById('modal-add-btn');
            const msg = document.getElementById('stock-msg');
            
            btn.disabled = true; btn.innerText = "Selecione Tamanho"; msg.innerText = "";
            const sizes = ['P','M','G','GG'];
            
            sizesDiv.innerHTML = sizes.map(s => {
                const qty = (currentProduct.inventory && currentProduct.inventory[s] !== undefined) ? currentProduct.inventory[s] : 99;
                const dis = qty === 0 ? 'disabled' : '';
                const style = qty === 0 ? 'opacity-50 cursor-not-allowed bg-gray-100 text-gray-400' : 'hover:border-pink-500 cursor-pointer';
                return `<div class="relative">
                    <input type="radio" name="mod-sz" id="ms-${s}" value="${s}" ${dis} class="hidden size-radio" onchange="checkStock('${s}', ${qty})">
                    <label for="ms-${s}" class="w-10 h-10 flex items-center justify-center text-xs font-bold border border-gray-200 rounded ${style}">${s}</label>
                </div>`;
            }).join('');

            const relSec = document.getElementById('related-section');
            const relGrid = document.getElementById('related-grid');
            if(currentProduct.relatedIds && currentProduct.relatedIds.length > 0) {
                const rels = allProducts.filter(x => currentProduct.relatedIds.includes(x.id));
                relGrid.innerHTML = rels.map(r => `<div class="cursor-pointer group" onclick="openProductModal(${r.id})">
                    <div class="h-20 rounded overflow-hidden mb-1"><img src="${r.images[0]}" class="w-full h-full object-cover"></div>
                    <p class="text-[8px] font-bold uppercase truncate">${r.name}</p>
                </div>`).join('');
                relSec.classList.remove('hidden');
            } else { relSec.classList.add('hidden'); }

            document.getElementById('product-modal').style.display = 'flex';
        }

        function checkStock(size, qty) {
            const btn = document.getElementById('modal-add-btn');
            const msg = document.getElementById('stock-msg');
            btn.disabled = false; btn.innerText = "ADICIONAR √Ä SACOLA";
            
            if(qty < 5) { msg.innerText = `üî• Restam apenas ${qty} unidades!`; msg.style.color='#db2777'; }
            else { msg.innerText = "Em estoque ‚úî"; msg.style.color='green'; }

            btn.onclick = () => {
                cart.push({...currentProduct, size: size});
                updateCartUI(); closeProductModal(); toggleCart(true);
            };
        }

        function closeProductModal() { document.getElementById('product-modal').style.display='none'; }

        function clearCart() { if(cart.length>0 && confirm("Esvaziar sacola?")) { cart=[]; updateCartUI(); } }
        function toggleCart(o) { const s=document.getElementById('cart-sidebar'); o? (s.classList.remove('cart-closed'),s.classList.add('cart-open')) : (s.classList.remove('cart-open'),s.classList.add('cart-closed')); }
        
        function updateCartUI() {
            const c = document.getElementById('cart-items');
            document.getElementById('cart-count').innerText = cart.length;
            const t = cart.reduce((a,b)=>a+b.price,0)+shippingValue;
            document.getElementById('cart-total').innerText = `R$ ${t.toFixed(2)}`;
            if(cart.length===0){ c.innerHTML='<div class="h-full flex flex-col items-center justify-center opacity-30 text-xs font-bold uppercase"><i class="fas fa-shopping-basket text-4xl mb-2"></i>Sua sacola est√° vazia</div>'; return; }
            c.innerHTML = cart.map((i,x) => `<div class="flex gap-3 p-3 bg-white border border-gray-100 rounded shadow-sm relative"><img src="${i.images[0]}" class="w-12 h-12 object-cover rounded"><div class="flex-1"><h4 class="font-bold text-[10px] uppercase truncate w-32">${i.name}</h4><p class="text-[10px] text-gray-500">Tam: <b>${i.size}</b> | R$ ${i.price.toFixed(0)}</p></div><button onclick="cart.splice(${x},1);updateCartUI()" class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button></div>`).join('');
        }

        function maskPhone(i){let v=i.value.replace(/\D/g,'');v=v.replace(/^(\d\d)(\d)/g,"($1) $2");v=v.replace(/(\d{5})(\d)/,"$1-$2");i.value=v;}
        function maskCEP(i){let v=i.value.replace(/\D/g,'');v=v.replace(/^(\d{5})(\d)/,"$1-$2");i.value=v;}
        async function searchCEP() {
            const c = document.getElementById('cep-input').value.replace(/\D/g,'');
            if(c.length!==8) return alert('CEP Inv√°lido');
            try {
                const r = await fetch(`https://viacep.com.br/ws/${c}/json/`);
                const d = await r.json();
                if(d.erro) throw new Error();
                document.getElementById('cust-address').value = `${d.logradouro}, ${d.bairro}`;
                shippingValue = d.uf === 'RJ' ? 15.00 : 30.00;
                document.getElementById('shipping-result').innerText = `Frete: R$ ${shippingValue.toFixed(2)}`;
                updateCartUI();
            } catch { alert('CEP n√£o encontrado'); }
        }
        function filterCategory(c) {
            currentCategory = c;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active', 'text-white'));
            event.target.classList.add('active', 'text-white');
            const grid = document.getElementById('product-grid'); grid.style.opacity='0';
            setTimeout(()=>{ renderProducts(c==='all'?allProducts:allProducts.filter(p=>p.category===c)); grid.style.opacity='1'; },300);
        }
        function filterProducts() {
            const q = document.getElementById('search-input').value.toLowerCase();
            renderProducts(allProducts.filter(p=>p.name.toLowerCase().includes(q)));
        }

        function finishOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const addr = document.getElementById('cust-address').value;
            const num = document.getElementById('cust-number').value;
            const cep = document.getElementById('cep-input').value;

            if(cart.length===0) return alert("Carrinho vazio.");
            if(!name || !phone || !addr || !num) return alert("Preencha todos os dados.");
            if(shippingValue===0) return alert("Calcule o frete.");

            let text = `*PEDIDO CRISMISSFIT* üèÉ‚Äç‚ôÄÔ∏èüíñ\n\n`;
            text += `üë§ *Cliente:* ${name}\nüì± *Contato:* ${phone}\n`;
            text += `üìç *Entrega:* ${addr}, ${num} - CEP ${cep}\n\n`;
            text += `üì¶ *RESUMO DO PEDIDO:*\n`;
            cart.forEach(i => text += `‚ñ´Ô∏è ${i.name} (${i.size}) R$ ${i.price.toFixed(2)}\n`);
            
            const total = cart.reduce((a,b)=>a+b.price,0)+shippingValue;
            text += `\nüöö *Frete:* R$ ${shippingValue.toFixed(2)}`;
            text += `\nüíé *TOTAL FINAL:* R$ ${total.toFixed(2)}\n\n`;
            text += `üîó *PAGAMENTO:* ${mpPaymentLink}\n`;
            text += `_Envie o comprovante para confirmar._`;

            window.open(`https://api.whatsapp.com/send?phone=5521983340089&text=${encodeURIComponent(text)}`, '_blank');
            setTimeout(() => { cart=[]; updateCartUI(); toggleCart(false); }, 2000);
        }
    </script>
</body>
</html>